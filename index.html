<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mothership Down!</title>
    <link rel="stylesheet" type="text/css" href="./assets/stylesheets/reset.css" />
    <link rel="stylesheet" type="text/css" href="./assets/stylesheets/mainpage.css" />
    <script>
      document.addEventListener('DOMContentLoaded', () => {

        //initialize canvas vars
        const canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        ctx.fillStyle = 'white';


        //initialize cannon vars
        let cannon = {
          posX: canvas.width/2,
          posY: canvas.height - 100,
          generateSelf: function() {
            ctx.fillRect(this.posX, this.posY, 10, 20);
          }
        };
        cannon.generateSelf();

        //initialize bullet
        function bullet(x, y, velocity, width, height) {
          this.posX = x;
          this.posY = y;
          this.velocity = velocity;
          this.width = width;
          this.height = height;


            ctx.fillStyle = "orange";
            ctx.fillRect(this.posX, this.posY, this.width, this.height);
            this.alive = true;
          }

        //update bullets
        const bulletlist = [];
        //if bulletlist is not empty, run this every frame
        if (bulletlist.length > 0) {
          console.log("im here");
          window.setInterval(updateBullets(), 60);
        }

        function updateBullets() {

          bulletlist.forEach(bullet => {
            if (bullet.alive) {

              if (bullet.posY >= 0) {
                ctx.clearRect(bullet.posX, bullet.posY, bullet.width, bullet.height)
                bullet.posY -= 10;
                ctx.fillStyle = "orange";
                ctx.fillRect(bullet.posX, bullet.posY, bullet.width, bullet.height)
              } else {
                //destroy bullet
              }
            }
          });
        }


        //initialize keypress handler
        //this is also basically the update() for ship
        document.addEventListener('keydown', (e) => {
          ctx.fillStyle = 'white';
          switch (e.keyCode) {
            // case 38:
            // //up
            //   y -= 1;
            //   ctx.fillRect(x, y, 20, 20);
            //   break;
            // case 40:
            //   //down
            //   y += 1;
            //   ctx.fillRect(x, y, 20, 20);
            //   break;
            case 37:
                //left
              ctx.clearRect(cannon.posX, cannon.posY, 10, 20);
              cannon.posX -= 20;
              ctx.fillRect(cannon.posX, cannon.posY, 10, 20);
              break;
            case 39:
                //right
              ctx.clearRect(cannon.posX, cannon.posY, 10, 20);
              cannon.posX += 20;
              ctx.fillRect(cannon.posX, cannon.posY, 10, 20);
              break;
            case 32:
                //spacebar shoot
                bulletlist.push(new bullet(
                  cannon.posX, cannon.posY, 10, 4, 8));
                console.log(bulletlist);
                break;
            default:

          }
        })

      })
    </script>
  </head>
  <body>
    <div class="content-container">
      <div class="game-viewport">
        <div class="bg-cutter">
          <div id="canvas-bg"></div>
          <canvas id="canvas" height="400" width="600" tabindex='1'></canvas>
        </div>
      </div>
    </div>
  </body>
</html>
