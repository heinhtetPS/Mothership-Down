<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mothership Down!</title>
    <link rel="stylesheet" type="text/css" href="./assets/stylesheets/reset.css" />
    <link rel="stylesheet" type="text/css" href="./assets/stylesheets/mainpage.css" />
    <script>
      document.addEventListener('DOMContentLoaded', () => {

        //run once
        initialize();

        //run every frame
        window.setInterval(update, 60);
        window.setInterval(draw, 60);

        //initialize canvas vars
        function initialize() {

          window.canvas = document.getElementById('canvas');
          window.ctx = canvas.getContext('2d');
          ctx.fillStyle = 'white';

          //initialize cannon vars
          window.cannon = {
            posX: canvas.width/2,
            posY: canvas.height - 100,
            width: 15,
            height: 30,
            drawSelf: function() {
              ctx.fillStyle = "white";
              ctx.fillRect(this.posX, this.posY, this.width, this.height);
            }
          };

          //used with screen logic
          window.screenResets = {
            top: 0,
            bottom: 400,
            left: 0,
            right: 600
          }

          //list of bullets on screen
          window.bulletList = [];
          //list of enemies on screen
          window.enemyList = [];
        }




        //main bullet script
        function bullet(x, y, velocity, width, height) {
            this.alive = false;
            this.spawn = function(x, y, velocity, width, height) {
              this.posX = x;
              this.posY = y;
              this.velocity = velocity;
              this.width = width;
              this.height = height;
              this.alive = true;
            }

            this.drawSelf = function() {

              ctx.clearRect(this.posX, this.posY, this.width, this.height);
              ctx.fillStyle = "orange";
              ctx.fillRect(this.posX, this.posY, this.width, this.height);
            }
          }

          //main enemy script
          function enemyShip(x, y, velocityX, velocityY, width, height) {
            this.alive = false;
            this.defaultVelocityX = 20;
            this.defaultVelocityY = 20;
            this.defaultWidth = 30;
            this.defaultHeight = 30;

            this.spawn = function(x, y, velocityX, velocityY, width, height) {
              this.posX = x;
              this.posY = y;
              this.velocityX = velocityX;
              this.velocityY = velocityY;
              this.width = width;
              this.height = height;
              this.alive = true;
            }

            this.drawSelf = function() {
              ctx.clearRect(this.posX, this.posY, this.width, this.height);
              ctx.fillStyle = "white";
              ctx.fillRect(this.posX, this.posY, this.width, this.height);
            }

          }

        function update() {
          updateBullets();
        }

        function cannonScreenResets() {
          if (cannon.posX < window.screenResets.left)
          cannon.posX = 580;
          if (cannon.posX > window.screenResets.right)
          cannon.posX = 0;
        }


        //if bulletList is not empty, run this every frame
        function updateBullets() {
          bulletList.forEach(bullet => {
            if (bullet.alive) {

              if (bullet.posY >= 0) {
                ctx.clearRect(bullet.posX, bullet.posY, bullet.width, bullet.height)
                bullet.posY -= 10;
                ctx.fillStyle = "orange";
                ctx.fillRect(bullet.posX, bullet.posY, bullet.width, bullet.height)
              } else {
                //destroy bullet
              }
            }
          });
        }

        //remove bullets from bulletlist

        function draw() {
          //draw main cannon
          cannon.drawSelf();

        }



        //initialize keypress handler
        //this is also basically the update() for ship
        document.addEventListener('keydown', (e) => {
          ctx.fillStyle = 'white';
          switch (e.keyCode) {
            // case 38:
            // //up
            //   y -= 1;
            //   ctx.fillRect(x, y, 20, 20);
            //   break;
            // case 40:
            //   //down
            //   y += 1;
            //   ctx.fillRect(x, y, 20, 20);
            //   break;
            case 37:
                //left
              ctx.clearRect(cannon.posX, cannon.posY, cannon.width, cannon.height);
              cannon.posX -= 20;
              cannonScreenResets();
              ctx.fillRect(cannon.posX, cannon.posY, cannon.width, cannon.height);
              break;
            case 39:
                //right
              ctx.clearRect(cannon.posX, cannon.posY, cannon.width, cannon.height);
              cannon.posX += 20;
              cannonScreenResets();
              ctx.fillRect(cannon.posX, cannon.posY, cannon.width, cannon.height);
              break;
            case 32:
                //spacebar shoot
                let nb = new bullet(
                  cannon.posX + 5, cannon.posY, 10, 6, 12);
                  nb.spawn(cannon.posX + 5, cannon.posY, 10, 6, 12);
                  nb.drawSelf();
                  bulletList.push(nb);
                console.log(bulletList);
                break;
            default:

          }
        })

      })
    </script>
  </head>
  <body>
    <div class="content-container">
      <div class="game-viewport">
        <div class="bg-cutter">
          <div id="canvas-bg"></div>
          <canvas id="canvas" height="400" width="600" tabindex='1'></canvas>
        </div>
      </div>
    </div>
  </body>
</html>
